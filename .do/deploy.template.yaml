# Specification for the deployment
# You can check the documentation about the App Specification here:
# https://docs.digitalocean.com/products/app-platform/reference/app-spec/

spec:
  # Name of the deployment
  name: digitalocean-saas-starter-kit
  # Optionally you can chose a region where the deployment will be hosted
  # Otherwise, DO will chose the nearest region for you in the wizard
  # region: nyc

  # Configuration for services (nextjs app)
  services:
    - name: saas-application # Name of the service
      environment_slug: node-js # Runtime environment
      git:
        branch: main # Git branch to deploy
        repo_clone_url: https://github.com/ajot/do-starter-kit # Repository URL
      source_dir: ./application # Directory containing the service source code
      build_command: "npm install && npm run build" # Command to build the service
      run_command: "npm run start" # Command to run the service
      http_port: 3000 # Port the service listens on
      instance_count: 1 # Number of instances to deploy
      instance_size_slug: apps-s-1vcpu-0.5gb # Instance size
      envs: # Environment variables for the service
        # These variables are using variable binding
        # You can check the documentation about variable binding here:
        # https://docs.digitalocean.com/products/app-platform/how-to/use-environment-variables/#using-bindable-variables-within-environment-variables
        - key: "POSTGRES_HOST"
          value: "${saas-kit-db.HOSTNAME}"
          type: "SECRET"
        - key: "POSTGRES_PORT"
          value: "${saas-kit-db.PORT}"
          type: "SECRET"
        - key: "POSTGRES_DB"
          value: "${saas-kit-db.DATABASE}"
          type: "SECRET"
        - key: "POSTGRES_USER"
          value: "${saas-kit-db.USERNAME}"
          type: "SECRET"
        - key: "POSTGRES_PASSWORD"
          value: "${saas-kit-db.PASSWORD}"
          type: "SECRET"
        - key: "SPACES_KEY"
          value: ""
        - key: "SPACES_SECRET"
          value: ""
          type: "SECRET"
        - key: "SPACES_BUCKETNAME"
          value: ""
        - key: "SPACES_REGION"
          value: ""
        - key: "SPACES_ENDPOINT"
          value: ""
        - key: "STORAGE_PROVIDER"
          value: "Spaces"

  # Configuration for databases
  databases:
    - name: saas-kit-db # Name of the resource
      engine: PG # Database engine (PostgreSQL)
      version: "15" # Database version
      production: false # Whether the database is for production
      cluster_name: saas-kit-db-cluster # Name of the database cluster
      # Optionally you can specify the database name and user, otherwise the resource name will be used
      # db_name: example-db
      # db_user: example-user
